---
import Layout from "../layouts/Layout.astro";
import Breadcrumbs from "../components/Breadcrumbs.astro";
import { getCollection } from "astro:content";
import RichText from "../components/portableText/RichText.astro";
import { urlFor } from "../data/_helpers";
import GalleryBlock from "../components/GalleryBlock.astro";

export async function getStaticPaths() {
  const subPages = await getCollection("subPages");

  return subPages.map((result: any) => ({
    params: {
      subPage: result.data.fullSlug,
    },
    props: {
      data: result.data,
    },
  }));
}

const { data } = Astro.props;
---

<Layout metaTitle={data.title}>
  <div class="l-subpage">
    {
      data.bannerImage && (
        <div class="l-subpage__banner-image">
          <picture>
            <source
              media="(max-width: 640px)"
              srcset={urlFor(data.bannerImage).width(640).url()}
            />
            <source
              media="(max-width: 1024px)"
              srcset={urlFor(data.bannerImage).width(1024).url()}
            />
            <img
              src={urlFor(data.bannerImage).width(1900).url()}
              alt=""
              loading="lazy"
            />
          </picture>
        </div>
      )
    }
    <div class="u-max-content-width">
      <div class="l-subpage__breadcrumbs">
        <Breadcrumbs current={data.title} parent={data.parent} />
      </div>
    </div>
    <div class="u-max-content-width">
      <h1 class="l-subpage__title">{data.title}</h1>
      {data.leading && <div class="l-subpage__leading">{data.leading}</div>}
      {
        data.body !== null && (
          <div class="l-subpage__body | u-rich-text">
            <RichText content={data.body} />
          </div>
        )
      }
    </div>
  </div>
</Layout>
