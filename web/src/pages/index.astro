---
import Layout from "../layouts/Layout.astro";
import MoreLink from "../components/MoreLink.astro";
import Hero from "../components/Hero.astro";
import Teaser from "../components/Teaser.astro";
import Card from "../components/Card.astro";
import { getCollection } from "astro:content";
import { formatDate } from "../data/_helpers";
import { getNewsArchiveData } from "../data/newsArchive";
import { getFrontPageData } from "../data/frontPage";

const frontPage = await getFrontPageData();
const newsArchive = await getNewsArchiveData();
const newsArchiveSlug = newsArchive.fullSlug;
const newsArticles = await getCollection("newsArticles");
let articles: any[] = [];
newsArticles.map((article: any, index: number) => {
  if (index < 4) {
    articles.push(article.data);
  } else {
    return;
  }
});
---

<Layout metaTitle="Forside">
  <div class="l-frontpage">
    <h1 class="u-visually-hidden">{frontPage.title}</h1>
    <section class="l-frontpage__banner">
      <Hero
        title={frontPage.banner.title}
        subtitle={frontPage.banner.subtitle}
        image={frontPage.banner.image}
      >
        {frontPage.banner.intro}
      </Hero>
    </section>
    <div class="u-max-content-width">
      <section class="l-frontpage__blocks">
        {
          frontPage.blocks.map((block: any, index: number) => (
            <Teaser
              image={block.image}
              title={block.title}
              text={block.content}
              link={{
                text: block.linkText,
                href: block.link.href,
              }}
              imagePlacement={block.imagePlacement}
            />
          ))
        }
      </section>
    </div>
    <div class="u-max-content-width">
      <section class="l-frontpage__cards">
        <h2 class="l-frontpage__cards-title">
          {
            frontPage.newsSection.title
              ? frontPage.newsSection.title
              : "Nyheter"
          }
        </h2>
        <div class="l-frontpage__cards-list">
          {
            articles.map(
              (article: any, index: number) =>
                index < 4 && (
                  <Card
                    title={article.title}
                    text={article.leading}
                    imageUrl={article.featuredImage}
                    date={formatDate(article.publishedDate)}
                    href={article.fullSlug}
                  />
                ),
            )
          }
        </div>
        <div class="l-frontpage__cards-more-link">
          <MoreLink href={newsArchiveSlug}
            >{
              frontPage.newsSection.moreText
                ? frontPage.newsSection.moreText
                : "Se flere nyheter"
            }</MoreLink
          >
        </div>
      </section>
    </div>
  </div>
</Layout>
